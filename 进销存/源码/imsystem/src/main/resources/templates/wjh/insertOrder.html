<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<meta name="viewport"
	content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
<title>订单新增</title>
<link rel="stylesheet" th:href="@{/assets/css/bootstrap.min.css}" />
<script type="text/javascript" th:src="@{/assets/js/jquery-1.8.2.js}"></script>
<link rel="stylesheet"
	th:href="@{/assets/css/bootstrap-datetimepicker.min.css}" />
<script type="text/javascript" th:src="@{/assets/js/bootstrap.min.js}"></script>
<script type="text/javascript"
	th:src="@{/assets/js/bootstrap-datetimepicker.js}"></script>
<link rel="stylesheet" th:href="@{/assets/css/font-awesome.min.css}">
<link rel="stylesheet" th:href="@{/assets/css/style.css}">
<!-- MAIN CSS -->
<link rel="stylesheet" th:href="@{/assets/css/main.css}">
<link rel="stylesheet" th:href="@{/assets/css/demo.css}">
<!-- GOOGLE FONTS -->
<link rel="apple-touch-icon" sizes="76x76"
	th:href="@{/assets/img/apple-icon.png}">
<link rel="icon" type="image/png" sizes="96x96"
	th:href="@{/assets/img/favicon.png}">
<script th:src="@{/assets/js/jquery.slimscroll.min.js}"></script>
<script th:src="@{/assets/js/klorofil-common.js}"></script>
<script type="text/javascript"  th:src="@{/assets/js/vue.js}"></script>
<style type="text/css">
.jiben>div {
	margin-top: 10px;
}

.shappingImg {
	width: 35px;
	height: 35px;
}

.table>tbody>tr>td {
	line-height: 35px;
	white-space: nowrap;
	text-align: center;
}

.container-fluid {
	overflow-x: auto;
}

.table>thead>tr>th {
	white-space: nowrap;
	text-align: center;
}

.panel-body {
	display: none;
	height: 170px;
	overflow-y: hidden;
	border: none;
	margin-bottom: 10px;
	margin-top: -10px;
	overflow-y: hidden;
}

.slimScrollDiv {
	display: none;
}

.input-group-addon {
	color: white;
	background-color: rgb(2, 143, 208);
	border-color: rgb(2, 143, 208);
}

@media ( max-width : 767px) {
	.btnShapping {
		width: 100%;
	}
	.btnShapping>div {
		width: 50%;
	}
}

.list-inline>li {
	padding: 5px;
	position: relative;
	z-index: 2;
	cursor: pointer;
	padding: 5px 8px;
	overflow: hidden;
	text-overflow: ellipsis;
	white-space: nowrap;
	max-width: 100px;
}

.list-inline {
	-webkit-user-select: none;
}

.backage {
	background: rgb(2, 143, 208);
	position: absolute;
	z-index: 1;
}
</style>
</head>

<body>
	<div class="main">
		<div class="main-content">
			<div class="container-fluid">
				<div class="panel panel-headline" id="main">
					<div class="panel-heading">
						<h3 class="panel-title">添加进货订单</h3>
						<p class="panel-subtitle">Period: Oct 14, 2016 - Oct 21, 2016</p>
					</div>
					<div class="row"
						style="position: fixed; bottom: 0px; padding-right: 15px; width: 100%; z-index: 999;">
						<div class="col-xs-12">
							<div class="container-fluid"
								style="background-color: #00AAFF; border-radius: 4px;">
								<div class="btn-group" style="float: right;">
									<div class="btn"
										style="border: none; box-shadow: none; color: #e84242; font-size: 16px;">
										<span style="color:white">应付：</span>$<span>2100</span>
									</div>
									<div class="btn"
										style="border: none; box-shadow: none; color: #e84242; font-size: 16px;">
										<span style="color:white">实付：</span>$<span>2100</span>&nbsp;<span class="badge" style="background: #e84242;">4</span>
									</div>
									<div class="btn btn-primary" id="insertOrder"
										style="border: none; box-shadow: none; font-size: 16px;">确定订单</div>
								</div>
								<div class="visible-md-block visible-lg-block visible-sm-block"
									style="float: left;">
									<span class="btn" style="color: white; box-shadow: none;">温馨提示：商品千万件，质量第一件。商品不规范，顾客两行泪</span>
								</div>
							</div>
						</div>
					</div>
					<form action="#" class="container-fluid" method="post">
						<div class="row jiben">
							<div class="col-md-5 col-sm-6 col-xs-12">
								<div class="input-group">
									<span class="input-group-addon">编号</span> <input
										class="form-control" id="No" placeholder="订单编号" />
								</div>
							</div>
							<div class="col-md-7 col-sm-6 col-xs-12">
								<div class="input-group">
									<span class="input-group-addon">时间</span> <input
										class="form-control datetimepicker" style="margin: 0px;"
										id="time" placeholder="订单编号" />
								</div>
							</div>
						</div>
						<div style="display: flex; padding: 15px 0px 0px 0px;">
							<span style="padding: 5px;">供应商：&nbsp;</span>
							<ul class="list-inline" style="margin: 0px;">
								<div class="backage"></div>
								<li>laowangasdfasdfasdfsadfsadfasdfsadf</li>
								<li>勇哥</li>
								<li>dws</li>
								<li>bitch</li>
							</ul>
						</div>
						<div style="display: flex; padding: 5px 0px 15px 0px;">
							<span style="padding: 5px;">支付类型：&nbsp;</span>
							<ul class="list-inline" style="margin: 0px;">
								<div class="backage"></div>
								<li>现金</li>
								<li>微信</li>
								<li>支付宝</li>
								<li>银行卡</li>
							</ul>
						</div>
						<div class="row" style="margin-bottom: 20px;">
							<div class="col-xs-12">
								<div class="container-fluid"
									style="background-color: #00AAFF; border-radius: 4px;">
									<div class="btn-group btnShapping" style="float: right;">
										<div class="btn btn-primary"
											style="border: none; box-shadow: none; font-size: 15px;">新增商品</div>
										<div class="btn btn-primary"
											style="border: none; box-shadow: none; font-size: 15px;">扫描条形码</div>
										<div class="btn btn-primary" id="queryShapping"
											style="border: none; box-shadow: none; font-size: 15px;">添加商品</div>
									</div>
									<div class="visible-md-block visible-lg-block visible-sm-block"
										style="float: left;">
										<span class="btn" style="color: white; box-shadow: none;">温馨提示：可以先新增商品，在添加需要的商品</span>
									</div>
								</div>
							</div>
						</div>
						<div class="row" style="margin-top: 10px;">
							<div class="col-md-4 col-sm-6 col-xs-12" style="display: none">
								<div id="panel-scrolling-demo" class="panel">
									<div class="panel-heading row btn-next">
										<h3 class="panel-title col-md-4 col-xs-4">vovi 21x</h3>
										<div class="col-md-5 col-xs-5"
											style="overflow-x: hidden; font-size: 14px; color: #ACB0B5;">
											<span>8G*64G，红色</span>
										</div>
										<div class="col-md-1 col-xs-1">
											<span class="badge" style="background: #e84242;">1</span>
										</div>
										<div class="right" style="right: 25px;">
											<button type="button">
												<i>×</i>
											</button>
										</div>

									</div>
									<div class="panel-body row">
										<div class="col-md-3 col-md-offset-1">
											<img th:src="@{/assets/img/profile-bg.png}" width="100%"
												height="80px" />
										</div>
										<div class="col-md-8"
											style="font-size: 14px; white-space: nowrap;">
											<div style="font-size: 20px;">vovi 21X</div>
											<div>8G*64G，红色</div>
											<div>
												<span>$2100</span> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>Count:&nbsp;<input
													value="1" style="border: none; outline: none;"></span>
											</div>
											<div>
												总计：<span style="color: red; font-size: 18px;">$2100</span>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</form>
				</div>
			</div>
		</div>
	</div>
	
	<script type="text/javascript" th:inline="javascript">
		$('.datetimepicker').datetimepicker({
			format : 'yyyy-mm-dd hh:ii',
			autoclose : 1
		});
		
		var vue = new Vue({
			el:"#main",
			data:{
				
			},
			methods:{
				
			}
		});

		function posi(index, index1) {
			var height = $(
					".list-inline:eq(" + index1 + ")>li:eq(" + index + ")")
					.innerHeight();
			var width = $(
					".list-inline:eq(" + index1 + ")>li:eq(" + index + ")")
					.innerWidth();
			var top = $(".list-inline:eq(" + index1 + ")>li:eq(" + index + ")")
					.offset().top;
			var left = $(".list-inline:eq(" + index1 + ")>li:eq(" + index + ")")
					.offset().left;
			$(".list-inline:eq(" + index1 + ")>li").css("color", "#676a6d");
			$(".backage:eq(" + index1 + ")").animate(
					{
						"top" : top + "px",
						"left" : left + "px",
						"width" : width + "px",
						"height" : height + "px"
					},
					400,
					function() {
						$(".list-inline:eq(" + index1 + ")>li").css("color",
								"#676a6d");
						$(
								".list-inline:eq(" + index1 + ")>li:eq("
										+ index + ")").css("color", "white");
					});
		}

		$(function() {
			var myDate = new Date();
			var date = myDate.getFullYear() + "-"
					+ dateTime(parseInt(myDate.getMonth()) + 1) + "-"
					+ dateTime(myDate.getDate());
			var time = date + " " + dateTime(myDate.getHours()) + ":"
					+ dateTime(myDate.getMinutes()) + ":"
					+ dateTime(myDate.getSeconds());
			$("#time").val(time);
			$("#No").val(
					myDate.getFullYear() + ""
							+ dateTime(parseInt(myDate.getMonth()) + 1) + ""
							+ dateTime(myDate.getDate())
							+ dateTime(myDate.getHours()) + ""
							+ dateTime(myDate.getMinutes()) + ""
							+ dateTime(myDate.getSeconds()));
			posi(0, 0);
			posi(0, 1);
			$(".btn-next").click(function() {
				if ($(this).next().css("display") == "none") {
					$(this).next().slideDown();
					$(this).next().find(".panel-body").show();
				} else {
					$(this).next().slideUp();
				}
			});
			$(".list-inline>li").click(
					function() {
						var index1 = $(".list-inline").index($(this).parent());
						var index = $(".list-inline:eq(" + index1 + ")>li")
								.index(this);
						posi(index, index1);
					});
			$("#queryShapping").click(function() {
				location = [[@{/goods/orderPickGoods}]];
			});
			$(".insertOrder").click(function(){
				
			});
			$("#insertOrder").click(function(){
				
				if(vue.typeId){
					
					var order = {
							column1 : $(".yprice").text(),
							sid : vue.givemeId,
							code : $("#No").val(),
							time : $("#time").val(),
							stockdetails : [],
							column2 : $(".sprice").val(),
							column3 : $(".sumcount").text(),
							uid : 1,
							state : 0,
							storeid : 1
					};
					
					order.time = eval('new Date(' + order.time.replace(/\d+(?=-[^-]+$)/,    
							function (a) { return parseInt(a, 10) - 1; }).match(/\d+/g) + ')');  
					
					
					//添加商品id
					for(var i = 1 ; i < $(".panel-title").length ; i ++){
						
						var shapping = {
								gvid : $(".panel-title:eq("+i+")").attr("data"),
								count : $(".panel-title:eq("+i+")").next().next().text(),
								price : $(".jprice:eq("+(i-1)+")").text()
						};
						
						order.stockdetails.push(shapping);
						
					}
					$.ajax({
						url : [[@{/insertOrder/insertOrder}]],
						data : JSON.stringify(order),
						type : "post",
						dataType : "text",
						contentType : "application/json",
						processData : false,
						success : function(result){
							alert(result);
						}
						
					});
					
				}else{
					alerts("请选择供应商")
				}
			});
			$(".count").bind("input propertyChange",function(){
				
				var count = $(this).val();
				
				var price = $(this).parent().prev().text();
				
				var index = $(".count").index(this);
				
				$(".sumPrice:eq("+index+")").text(count*price);
				
				if(count == ""){
					count = 0;
				}
				
				$(".badgecount:eq("+index+")").text(count);
				counts();
         	});
         	$(".model-list>li").click(function(){
         		$(".model-list>li").removeClass("givemedianji");
         		$(this).addClass("givemedianji");
         	});
         	$(".givemeok").click(function(){
         		var name = $(".givemedianji").text();
         		if(name){
         			var li = $(".giveme").prev().find("li:eq(0)");
             		var li1 = li.clone(true)
             		li1.text(name);
             		$(".giveme").prev().append(li1);
             		posi(($(".giveme").prev().find("li").length)-1,0);
         		}
         		
         	});
         	counts();
         	posi(0, 0);
			posi(0, 1);
         	
		});
		
		function alerts(str){
			
			toastr.options.timeOut = "false"
			
			toastr.options.closeButton = true;
			
			toastr['info']
					(str);
			
			$positionClass = 'toast-top-center';
			
			toastr.remove();
			
			$context="info";
			
			toastr[$context](str, '', {
				
				positionClass : $positionClass
				
			});
			
			setTimeout(function(){
				$("#toast-container").fadeOut(1000);
			},4000)
		}
		
		function counts(){
			var sumPrices = $(".sumPrice");
			var sum = 0 ; 
			
			$(".badgecount").each(function(i,e){
				
				sum+=parseInt($(e).text());
				
			});
			
			$(".sumcount").text(sum);
			
			sum = 0;
			
			$(sumPrices).each(function(i,e){
				sum +=parseFloat($(e).text());
			});
			
			$(".yprice").text(sum);
		}
		function dateTime(th) {
			if (th < 10) {
				return "0" + th;
			}
			return th;
		}
	</script>
</body>


</html>