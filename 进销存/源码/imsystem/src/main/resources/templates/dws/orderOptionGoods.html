<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
<meta charset="UTF-8">
<meta name="viewport"
	content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
<title>订单选择商品</title>
<link rel="stylesheet" th:href="@{/assets/css/bootstrap.min.css}">
<link rel="stylesheet" th:href="@{/assets/css/font-awesome.min.css}">
<link rel="stylesheet" th:href="@{/assets/css/main.css}">
<link rel="stylesheet" th:href="@{/assets/css/Animzte.css}" />
<link rel="stylesheet" th:href="@{/assets/css/typeDonghua.css}" />
<!--88888-->

<style>
.pagebtn {
	height: 28px;
	width: 25px;
	border: 1px solid #C0C0C0;
	border-radius: 3px;
	list-style: none;
	text-align: center;
	line-height: 28px;
	cursor: pointer;
}

#page>ul {
	display: flex;
	justify-content: space-around;
	padding: 0px;
	font-size: 12px;
}

#page {
	width: 300px;
	margin: 0px auto;
}

.currentPage {
	background: #1094ce;
	color: white;
	border: none;
}
/*上面是分页*/
.sum {
	max-width: 20%;
	border-radius: 5px;
	border: 1px solid #CCCCCC;
}
/*定义滚动条轨道 内阴影+圆角*/
/*.panel-body::-webkit-scrollbar-track {
				-webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3);
				border-radius: 10px;
				background-color: lightgray;
			}*/
/*定义滑块 内阴影+圆角*/
/*.panel-body::-webkit-scrollbar-thumb {
				border-radius: 10px;
				-webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, .3);
				background-color: blue;
			}
			*/
.panel-body::-webkit-scrollbar {
	width: 10px;
	height: 2px;
	background: #fff;
	border-radius: 10px;
	/*外层轨道*/
}

.panel-body::-webkit-scrollbar-thumb {
	display: block;
	width: 6px;
	margin: 0 auto;
	border-radius: 10px;
	background: #CCCCCC;
	/*内层轨道*/
}

.hideDiv {
	overflow: hidden;
	display: none;
}
/*添加样式*/
.shoppingCart {
	width: 94vw;
	margin: 0 3vh;
	padding: 0;
	position: fixed;
	bottom: 0;
	min-height: 6vh;
	max-height: 60vh;
}

.option-body {
	background-color: rgba(214, 224, 233, 0.54);
	border-radius: 20px 20px 10px 10px;
	box-shadow: 1px 1px 10px #94bcdc;
}

.panel {
	margin: 0;
}

.panel-body {
	display: block;
	overflow-y: auto;
	max-height: 50vh;
	padding: 0;
}

.shoppingDel {
	position: absolute;
	right: 1vh;
	top: -0.5vh;
	color: #f03731;
	cursor: pointer;
}

.titleDiv {
	padding: 2vh 5vh;
	margin: 0;
	color: #FFFFFF;
	background-color: rgb(2, 143, 208);
	border-radius: 10px;
}
</style>
<script type="text/javascript" th:src="@{/assets/js/jquery-1.8.3.js}"></script>
<script type="text/javascript" th:src="@{/assets/js/jquery.color.js}"></script>
<script type="text/javascript" th:src="@{/assets/js/page.js}"></script>
<script type="text/javascript" th:src="@{/assets/js/typeDonghua.js}"></script>
<script th:src="@{/assets/js/bootstrap.js}"></script>
<script th:src="@{/assets/js/vue.js}"></script>
<script type="text/javascript">

			//			function addGwcDonghua(Obj) {
			//
			//				var addImg = $(Obj).parents(".thumbnail").find("img"); //找到该商品的图片
			//
			//				var cloneImg = addImg.clone(); //对该图片进行克隆
			//				cloneImg.css({ //克隆的样式
			//
			//					"position": "absolute", //绝对定位
			//					"left": addImg.offset().left, //该图片的left位置
			//					"top": addImg.offset().top, //该图片的top位置
			//					"z-index": "200", //层级，越大越在上
			//					"opacity": "0.5" //透明度  半透明
			//				});
			//
			//				//克隆到body上的购物车位置
			//				cloneImg.appendTo($("body")).animate({
			//					"width": "50px", //克隆后的宽
			//					"height": "50px", //克隆后的宽
			//					"left": $(".panel").offset().left, //克隆后的left位置  购物车
			//					"top": $(".panel").offset().top - 120, //克隆后的left位置  购物车
			//				}, 1000, function() { //克隆后
			//					$(this).remove(); //清空购物车  不清除图片会叠加
			//				});
			//
			//			}

			/*
			 商品添加
			 * */
			function addSum(obj) {

				let nowCount = $(obj).next().val();

				$(obj).next().val((parseFloat(nowCount) + 1));

			}

			//商品数量减少
			function subtractSum(Obj) {

				let nowCount = $(Obj).prev().val();

				if(nowCount > 1) {

					$(Obj).prev().val((parseFloat(nowCount) - 1));

				}

			}

			//输入判定
			function countChange(Obj) {

				//判定是否数字
				$(Obj).val($(Obj).val().replace(/[^\d]/g, ''));

				let nowCount = $(Obj).val();

				if(nowCount > 999) {
					$(Obj).val("999");
				} else if(nowCount < 1) {
					$(Obj).val("1");
				}

			}
		</script>
</head>

<body>

	<div class="main">
		<div class="main-content">
			<div class="container-fluid">
				<div class="panel panel-headline">
					<div class="panel-heading">
						<h3 class="panel-title">报表 - 1</h3>
						<p class="panel-subtitle">Period: Oct 14, 2016 - Oct 21, 2016</p>
					</div>
					<!--小屏幕-->
					<div class="row" style="margin: 2vh 3vh;">

						<div class="row">

							<div class="col-xs-11 col-lg-12 col-md-12">
								<div class="input-group">
									<label class="input-group-addon">搜索:</label> <input type="text"
										id="liketext" class="form-control" placeholder="请输入关键字">

									<span class="input-group-btn lg-md-span">
										<button class="btn btn-primary" type="button">确 定</button>
									</span> <span class="input-group-btn lg-md-span">
										<button class="btn btn-primary" type="button">扫一扫</button>
									</span>
								</div>
							</div>

							<div class="col-xs-1">
								<div class="input-group">
									<span class="input-group-btn xs-span">
										<button class="btn btn-primary glyphicon glyphicon-list"></button>
									</span>
								</div>
							</div>

						</div>

					</div>

					<!--大，中屏幕的样式-->
					<div class="row visible-lg-block visible-md-block"
						style="margin: 0 3vh;">

						<div id="goodstype"></div>

						<div id="typeoption"></div>

					</div>

					<!--主体-->
					<div id="body"
						style="margin: 1vh 3vh 0 3vh; min-height: 60vh; background-color: #eae2e21f;">

						<hr />

						<div class="row">

							<div v-for="(item,index) in pageIf.list"
								class="col-sm-6 col-md-3">
								<div class="thumbnail">
									<img
										v-if="item.goodsValue.column1 == null || item.goodsValue.column1==''"
										style="max-height: 20vh; min-height: 20vh;"
										:src="'data:image/png;base64,'+item.goods.img" alt="...">
									<img v-else style="max-height: 20vh; min-height: 20vh;"
										:src="item.goodsValue.column1" alt="...">

									<div class="caption text-center">
										<h4>{{item.goods.name}}</h4>
										<p style="color: #777070;">
											<span>{{item.goods.column2}}&nbsp;</span><span>{{item.goodsValue.name}}</span>
											<span>￥: {{item.goods.price}}</span>
										</p>
										<p v-if="item.goods.column1 == null" style="color: #777070;">
											<span>库存：</span> <span>0</span>
										</p>
										<p v-else-if="item.goods.column1 < item.goods.minsecurity"
											style="color: #777070;">
											<span>库存：</span> <span style="color: red;">{{item.goods.column1}}</span>
										</p>
										<p v-else-if="item.goods.column1 > item.goods.minsecurity"
											style="color: #777070;">
											<span>库存：</span> <span>{{item.goods.column1}}</span>
										</p>

										<div class="input-group" style="margin: 0 auto;">
											<label class="add btn btn-default btn-xs"
												onclick="addSum(this)" style="margin-right: 5px;">+</label>
											<input type="text" :keyON="item.goodsValue.id"
												:value="isGetCount(item.goodsValue.id)" maxlength="3"
												oninput="countChange(this)" class="text-center sum">
											<label style="margin-left: 5px;" onclick="subtractSum(this)"
												class="subtract btn btn-default btn-xs">-</label>
										</div>



										<p>
											<a @click='addIdCountMap(item.goodsValue.id,$event)' class="btn btn-primary addgwc" role="button">加入</a>
										</p>
									</div>
								</div>
							</div>

						</div>

						<div id="page" style="margin-bottom: 60px;"></div>

					</div>

					<div class="row shoppingCart">
						<div class="panel">

							<div class="option-body hideDiv">

								<div class="panel-body">


									<div v-for="(item,index) in pickList()" style="height: 400px"
										class="col-sm-3 col-md-2">
										<div class="thumbnail" style="height: 390px">
											<span class="glyphicon glyphicon-remove shoppingDel"
												title="删除"></span> <img
												v-if="item.goodsValue.column1 == null || item.goodsValue.column1==''"
												style="max-height: 20vh; min-height: 20vh;"
												:src="'data:image/png;base64,'+item.goods.img" alt="...">
											<img v-else style="max-height: 20vh; min-height: 20vh;"
												:src="item.goodsValue.column1" alt="...">

											<div class="caption text-center">
												<h4>{{item.goods.name}}</h4>
												<p style="color: #777070;">
													<span>{{item.goods.column2}}&nbsp;</span><span>{{item.goodsValue.name}}</span>
												</p>
												<p>
													<span>￥: {{item.goods.price}}</span>
												</p>
												<p style="color: #777070;">
													<span>已选：</span> <span>{{isGetCount(item.goodsValue.id)}}</span>
												</p>
											</div>
										</div>
									</div>



								</div>

							</div>

							<div class="row titleDiv">
								<div class="col-lg-6">
									<h3 class="panel-title">
										<font class="btn"
											style="vertical-align: inherit; margin-right: 50px;"><font
											style="vertical-align: inherit;">已选购中的商品</font></font> <font
											style="vertical-align: inherit; margin-right: 50px;"><font
											style="vertical-align: inherit;">总件数:</font><span
											id="shoppingCount">20</span></font>
									</h3>
								</div>
								<div class="text-right col-lg-6">
									<span class="btn" style="margin-right: 3vw;">确认订单</span> <i
										class="glyphicon glyphicon-chevron-up ppp"></i>
								</div>
							</div>

						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<script type="text/javascript" th:inline="javascript">
		
var vue = new Vue({
	
	el:".main",
	data:{
		
		pageIf:"",
		idCountMap:"",
		list:[]
		
	},methods:{
		// 1获取数量
		isGetCount:function(gvid){
			
			let count = 1;
			
			for(var key in vue.idCountMap){
				if(gvid == key){
					count = vue.idCountMap[key];
				}
				
			}
			
			return count;
			
		},pickList:function(){
			if(this.list != ""){
				var pklist = [];
				vue.list.filter(function(item){
					
					for(var key in vue.idCountMap){
						if(item.goodsValue.id == key){
							pklist.push(item);
						}
						
					}
					
				});
				
				return pklist;
				
			}
		},addIdCountMap:function(id,element){
			
			var map = this.idCountMap;
			
			this.idCountMap = {};
			
			map[id] = $(element.currentTarget).parent().prev().find("[type=text]").val();
			
			this.idCountMap = map;
			
			
		}
	}
	
});

vue.idCountMap = [[${idCountMap}]];
vue.list = [[${list}]];


/**
 * 类型全选
 */
function typeAll(obj){
	
	activeSpanStyle(obj);
	var ind = $(obj).parent().parent().index();
	$(".option-top-div:gt("+ind+")").remove();
	$("#typeoption").html("");
	
	var tid = $(obj).attr("id");
	
	queryGoods(1,[],tid);
	
}

/*
*商品类型查询
*id 父级id
*/
function queryGoodsTypeByPid(obj,id,op){
	var bool =  activeSpanStyle(obj,op);
	
	if(!bool){
		
		return;
		
	}
	
	$.ajax({
		
		url:[[@{/goods/queryGoodsTypeByPid}]],
		dataType:"json",
		data:{"id":id},
		type:"post",
		success:function(data){
			
		 	var ind = $(obj).parent().parent().index();
			$(".option-top-div:gt("+ind+")").remove()
			
			if(data.length > 0){
					
				
				var div = $('<div class="option-div option-top-div row">');
				var divtitle = $('<div class="col-lg-1 col-md-1 text-right option-rongqi"><span class="visible-lg-inline-block visible-md-inline-block text-center option-span-title">类型</span></div>');
				div.append(divtitle);
				var divoption = $('<div class="col-lg-11 col-md-11 option-rongqi">');
				div.append(divoption);
				
				var activc = $('<span class="visible-lg-inline-block visible-md-inline-block visible-md-inline-block text-center activePosition option-span active1">');
				divoption.append(activc);
				
				var all = $('<span onclick="typeAll(this)"  class="visible-lg-inline-block visible-md-inline-block text-center option-span activeColor">全部</span>');
				divoption.append(all);
				
				$.each(data,function(){
					all.attr("id",this.pid);
					var option = $('<span onclick="queryGoodsTypeByPid(this,'+this.id+',false,)" class="visible-lg-inline-block visible-md-inline-block text-center option-span" id="'+this.id+'">'+this.name+'</span>');
					divoption.append(option);
					
				});
				
				$("#goodstype").append(div);
			}
			
		} 
		
	});
	 $.ajax({
		
		url:[[@{/goods/queryGoodsStandradByid}]],
		dataType:"json",
		data:{"id":id},
		type:"post",
		success:function(data){
		 	
			$("#typeoption").html("");	
			
				$.each(data,function(index,obj){
					
					var div = $('<div class="option-div option-type row">');
					$("#typeoption").append(div);
					
					var divtitle = $('<div class="col-lg-1 col-md-1 text-right option-rongqi"><span class="visible-lg-inline-block visible-md-inline-block text-center option-span-title">'+obj.name+'</span> </div>')
					div.append(divtitle);
					
					var divmain = $('<div class="col-lg-11 col-md-11 col-md-11 option-rongqi">');
					div.append(divmain);
					
					var spanall = $('<span onclick="typePojo(this)" class="visible-lg-inline-block visible-md-inline-block text-center option-span-all activeColor" style="background-color: #00AAFF;">不限</span>')
					divmain.append(spanall);
					$.each(obj.stabndardValueList,function(ind,item){
						
						var span = $('<span onclick="optionCheck(this)" class="visible-lg-inline-block visible-md-inline-block text-center option-span-z" sizeid="'+item.id+'">'+item.name+'</span>')
						divmain.append(span);
						
					})
					
				})
				
		}  
		
	}); 
	 
	 queryGoods(1,[],id);
	 
	
}

function typePojo(obj){
	
	optionAllStyle(obj);
	pojolike();
	
}

/**
 * 分页点击事件
 */
function floatPage(){
	
	queryGoods($('.currentPage').text(),[],0);
	
}


function optionCheck(obj){
	
	optionAddStyle(obj);
	
	pojolike();
	
	
	if ($(obj).parent().find(".active1").length == $(obj)
			.parent().find(".option-span-z").length) {

		$(obj).parent().find(".option-span-z").removeClass(
				"active1");
		$(obj).parent().find(".option-span-z").animate({
			backgroundColor : "",
			color : "#000000"
		}, 300);

		$(obj).parent().find(".option-span-all").addClass(
				"active1");
		$(obj).parent().find(".option-span-all").animate({
			backgroundColor : "#00AAFF",
			color : "#ffffff"
		}, 300);

	}

	
}


	function queryGoods(curPage,svid,tid){
		
		var liketext = $("#liketext").val();
		$.ajax({
			url:[[@{/goods/queryGoodsLikeAll}]],
			type:"post",
			data:{
				"curPage":curPage,
				"liketext":liketext,
				"svid":svid.join(','),
				"tid":tid
			},
			dataType:"json",
			success:function(data){
				
				vue.pageIf = data;
				
				page(vue);
				
				
			}
		});
		
	}
	
	//搜索框联动
	function textlike(obj){
		
		var tid = $("#goodstype .option-div:last").find(".activeColor").attr('id');
		
		var svid = 0;
		
		 queryGoods(1,[],tid);
		
	}
	
	
	//类型值联动
	function pojolike(){
		
		var svid = [];
		
		$("#typeoption .option-type").each(function(index,item){
		
			console.log($(item).find(".option-span-all").hasClass("active1"))
			
			if($(item).find(".option-span-all").hasClass("active1")){
			
				$(item).find('span').each(function(){
					
				svid.push($(this).attr('sizeid'));
					
				});
				
				console.log(svid)
				
			}else{
				
				$(item).find('.active1').each(function(){
					
					svid.push($(this).attr('sizeid'));
					
				});
				
				
			}
			
		});
		
		queryGoods(1,svid,0);
		
	}
	


	$(function() {
		
		queryGoodsTypeByPid(null,0,true);
		
		 queryGoods(1,[],0);
		
			//商品数量添加
			$(".add").click(function() {

				addSum(this);

			});

			//商品数量减少
			$(".subtract").click(function() {

				subtractSum(this);

			});

			//查看选中的商品
			$(".ppp").toggle(function() {

				$(this).parents(".panel").find(".option-body").slideDown(300);
				$(this).removeClass("glyphicon-chevron-up");
				$(this).addClass("glyphicon-chevron-down");

			}, function() {

				$(this).parents(".panel").find(".option-body").slideUp(300);
				$(this).removeClass("glyphicon-chevron-down");
				$(this).addClass("glyphicon-chevron-up");
			});

			//添加动画
			$(".addgwc").click(function() {

				//					addGwcDonghua(this);

			});

		 
	});
</script>

</body>

</html>