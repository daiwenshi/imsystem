<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
	<head>
	<title>Notifications</title>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
	<!-- VENDOR CSS -->
	<link rel="stylesheet" th:href="@{/assets/css/bootstrap.min.css}">
	<link rel="stylesheet" th:href="@{/assets/css/font-awesome.min.css}">
	<link rel="stylesheet" th:href="@{/assets/css/style.css}">
	<link rel="stylesheet" th:href="@{/assets/css/toastr.min.css}">
	<!-- MAIN CSS -->
	<link rel="stylesheet" th:href="@{/assets/css/main.css}">
	<!-- FOR DEMO PURPOSES ONLY. You should remove this in your project -->
	<link rel="stylesheet" th:href="@{/assets/css/demo.css}">
	<!-- GOOGLE FONTS -->
	<link th:href="@{https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700}" rel="stylesheet">
	<!-- ICONS -->
	<link rel="apple-touch-icon" sizes="76x76" th:href="@{/assets/img/apple-icon.png}">
	<link rel="icon" type="image/png" sizes="96x96" th:href="@{/assets/img/favicon.png}">
	<style type="text/css">
		*{
			-webkit-user-select: none;
		}
		.table{
				text-align: center;
				
			}
		.table>tbody>tr>td, .table>tfoot>tr>td, .table>tr>th, .table>thead>tr>td, .table>tr>th{
				border-top: 1px solid rgb(2, 143, 208);
				
			}
		.table>tbody>tr>th{
			border-top: none;
			border-bottom: 2px solid rgb(2, 143, 208);
		}
		th{
			text-align: center;
		}
		.ta{
			padding: 0px 20px;
		}
		.table-striped>tbody>tr:nth-of-type(odd){
				background-color: transparent;
			}
		
		.an{
			display: inline-block;
			background-color: white;
			color:rgb(2, 143, 208);
			margin-left: 5px;
			margin-right: 5px;
		} 
		.btn{
			background-color: rgb(2, 143, 208);
			color: white;
		}
		#lableDiv{
			width: 100%;
		}
		.labelSpan{
			display: inline-block;
			margin: 5px 7px;
			padding: 3px 10px;
			border: 1.5px solid rgb(2, 143, 208);
			border-radius: 18px;
			color: rgb(2, 143, 208);
		}
		.checkSpan{
			display: inline-block;
			margin: 5px 7px;
			padding: 3px 10px;
			border: 1.5px solid #f17272;
			border-radius: 18px;
			color: #f17272;
		}
	</style>
	</head>
	<body>
	
		<div class="main elDocument">
			<!-- MAIN CONTENT -->
			<div class="main-content">
				<div class="container-fluid">
					<div class="panel panel-headline">
						<div class="panel-heading">
							<h3 class="panel-title ptitle">客户标签</h3>
							<p class="panel-subtitle">Period: Oct 14, 2016 - Oct 21, 2016</p>
							<input type="hidden" value="" id="uid">
						</div>
						<div class="ta">
						<form id="lickSearchForm" action="" method="post" style="width: 60%">
						 	<input class="col-md-2 col-md-offset-7 " type="text" id="content" placeholder="请标签名称" />
						 	<input id="likeSearch" class="col-md-1 btn btn-primary btn-lg" type="button" value="GO" style="height: 27px;line-height: 5px;margin-bottom: 5px;" />
						 </form>
						 
						<button id="tijiao" type="button" value="新增" class="btn btn-primary btn-lg col-md-1 col-md-offset-1" data-toggle="modal" data-target="#myModal" style="height: 30px;line-height: 5px; margin-bottom: 5px; margin-left: 50px;" >
	  						新增
						</button>
						
						<form id="addUserLableForm" class="form-horizontal form-material" method="post" action="adduserlable">
							<input type="hidden" value="" name="ualobj.uid" id="addLableUid">
							<div class="form-group">
                                 <label class="col-sm-12">客户</label>
                                 <div class="col-sm-12">
                                     <select class="form-control form-contr;ol-line" id="customer" name="ualobj.uids">
                                          <option v-for="(o,i) in customerList" :value="o.id" >
                                                {{o.name}}
                                          </option>
                                     </select>
                              	</div>
                            </div>
                            <h4>可选标签</h4>
                            <div id="lableDiv">
                            
                            	<span v-for="(o,i) in lableList">
                            		<input type="hidden" :value="o.ulobj.id" name="" class="">
                            		<label v-if="o.ualobj==null" class="labelSpan" onclick="addLable(this)">{{o.ulobj.name}}</label>
                            		<label v-if="o.ualobj!=null" class="labelSpan checkSpan">{{o.ulobj.name}}</label>
                            	</span>
                            	
                            
                            </div>
						
						</form>
							
						</div>
						
					</div>
				</div>
			</div>
		</div>
		
		
	<script th:src="@{/assets/js/jquery.min.js}"></script>
	<script th:src="@{/assets/js/bootstrap.min.js}"></script>
	<script th:src="@{/assets/js/jquery.slimscroll.min.js}"></script>
	<script th:src="@{/assets/js/toastr.min.js}"></script>
	<script th:src="@{/assets/js/klorofil-common.js}"></script>	
    <script th:src="@{/assets/js/vue.js}"></script>
	<script type="text/javascript">
	
	var vue=new Vue({
		el:".elDocument",
		data:{
			user:{},
			customerList:"",
			lableList:""
		}
	});
	
	function show(cid){
		var name=$("#content").val();
		$.ajax({
			url:"querycustomerlable",
			data:{
				"cid":cid,
				"name":name
			},
			type:"post",
			dataType:"json",
			success:function(result){
				vue.lableList=result;
			}
		});
	}
	
	function addLable(th){
		var classValue=$(th).attr("class");
		if(classValue=="labelSpan"){
			/* 选中 */
			$(th).prev().attr("class","check");
			$(th).attr("class","labelSpan checkSpan");
		}else if(classValue=="labelSpan checkSpan"){
			/* 取消 */
			$(th).prev().attr("class","");
			$(th).attr("class","labelSpan");
		}
	}
	
		$(function(){
			vue.user = JSON.parse(window.localStorage.getItem("user"));
			$("#uid").val(vue.user.id);
			$("#addLableUid").val(vue.user.id);
			
			$.ajax({
				url:"querycustomer",
				data:"uid="+vue.user.id,
				type:"post",
				dataType:"json",
				success:function(result){
					vue.customerList=result;
					show(result[0].id);
				}
			});
			
			$("#customer").change(function(){
				var cv=$("#customer").val();
				show(cv);
			});
			
			$("#likeSearch").click(function(){
				var cv=$("#customer").val();
				show(cv);
			});
			
			 $("#tijiao").click(function(){
				$(".check").each(function(i,o){
					$(o).attr("name","ullist["+i+"].id");
				});
				$("#addUserLableForm").submit();
			});
			 
			
			 
			 
		});	
	</script>
	
</body>
</html>
