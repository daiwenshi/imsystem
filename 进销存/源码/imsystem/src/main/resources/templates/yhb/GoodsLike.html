<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta name="viewport"
	content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
<meta charset="UTF-8">
<title>BaoBiao - 1</title>
<link rel="stylesheet" th:href="@{/assets/css/bootstrap.min.css}">
<link rel="stylesheet" th:href="@{/assets/css/font-awesome.min.css}">
<link rel="stylesheet" th:href="@{/assets/css/style.css}">
<!-- MAIN CSS -->
<link rel="stylesheet" th:href="@{/assets/css/main.css}">
<!-- FOR DEMO PURPOSES ONLY. You should remove this in your project -->
<link rel="stylesheet" th:href="@{/assets/css/demo.css}">
<!-- GOOGLE FONTS -->
<link th:href="@{/assets/css/css.css}" rel="stylesheet">
<link rel="stylesheet" th:href="@{/assets/css/animate.min.css}" />
<!-- ICONS -->
<link rel="stylesheet" th:href="@{/assets/css/myStyle.css}" />
<link rel="apple-touch-icon" sizes="76x76"
	th:href="@{/assets/img/apple-icon.png}">
<link rel="icon" type="image/png" sizes="96x96"
	th:href="@{/assets/img/favicon.png}">
<script type="text/javascript" th:src="@{/assets/js/jquery.min.js}"></script>
<script type="text/javascript" th:src="@{/assets/js/bootstrap.min.js}"></script>
<link rel="stylesheet" type="text/css" media="all"
	th:href="@{/assets/css/daterangepicker.css}" />
<link rel="stylesheet" type="text/css"
	th:href="@{/assets/css/htmleaf-demo.css}">
<script>
	window.jQuery
			|| document
					.write('<script th:src="@{/assets/js/jquery-1.11.0.min.js}"><\/script>')
</script>
<script type="text/javascript" th:src="@{/assets/js/moment.js}"></script>
<script type="text/javascript" th:src="@{/assets/js/daterangepicker.js}"></script>
<script th:src="@{/assets/js/vue.js}"></script>
<script th:src="@{/assets/js/statistics.js}"></script>
<style>
.gv {
	height: 320px;
	padding: 5px 15px;
	margin: 15px 0px;
}

.goods {
	width: 100%;
	height: 100%;
	padding: 20px;
	margin-bottom: 20px;
}

.shopGoods {
	width: 100%;
	height: 100%;
	ovflow: hidden;
}

.shopGoods:hover {
	transform: scale(1.02) translateY(-20px);
}

.shopGoods:hover .gValue {
	border: 1px solid #00AAFF;
	border-top: 0px;
}

.shopGoods img {
	width: 100%;
	height: 130px;
}

.gName {
	height: 100px;
}

.but {
	height: 90px;
	width: 100%;
}

.but button {
	width: 38%;
	height: 38px;
	margin-top: 20px;
	border: 1px solid #00AAFF;
	background: #00AAFF;
	color: #fff;
}

.but a:nth-child(1)  button {
	float: left;
	margin-left: 8%;
	background: none;
	color: #00AAFF;
}

.but a:nth-child(2)  button {
	float: right;
	margin-right: 8%;
}

.name {
	float: left;
	margin: 20px 10px;
	white-space: nowrap;
	display: inline-block;
	width: 100%;
	height: 40px;
	overflow: hidden;
	text-overflow: ellipsis;
	line-height: 1.2;
}

.p {
	text-align: center;
	font-size: .8em !important;
	color: #c2c2c2;
}

.gValue {
	border: 1px solid #c2c2c2;
	border-top: 0px;
}
.news{
	min-width:200px;
	min-height:60px;
	background:rgba(000,000,000,.6);
	position: fixed;
	top:5%;
	left:40%;
	font-size:18px;
	padding:0 10px;
	color:#fff;
	text-align:center;
	line-height:60px;
	display:none;
	z-index:10000;
}
</style>
</head>
<body>
	<div class="main">
		<div class="main-content">
			<div class="container-fluid">
				<div class="panel panel-headline">
					<div class="panel-heading row">
						<h3 class="panel-title">猜你喜欢</h3>
						<p class="panel-subtitle">Period: Oct 14, 2016 - Oct 21, 2016</p>
					</div>
					<div class="col-md-6 col-xs-12 tj">
						<span class="col-md-3 col-xs-12">选择客户</span> <select
							class="col-md-9 col-xs-12 store">
							<option value="">全部</option>
							<option v-for="obj in customer"
								:value="obj.id+','+obj.column1+','+obj.name+','+obj.telephone">{{obj.name}}</option>
						</select>
					</div>
					<div class="col-md-6 col-xs-12 tj">
						<span class="col-md-3 col-xs-12">选择季节</span> <select
							class="col-md-9 col-xs-12 season">
							<option value="">全部</option>
							<option value="1">春</option>
							<option value="2">夏</option>
							<option value="3">秋</option>
							<option value="4">冬</option>
						</select>
					</div>
					<div class="goods">
						<div v-for="objs in goods" class="gv col-md-4 col-xs-12">
							<div class="shopGoods">
								<img :src="objs.column4">
								<div class="gValue">
									<div class="gName">
										<span class="name"><b>{{objs.name}}[{{objs.column1}}]</b></span><br>
										<p class="p col-md-6 col-xs-6">
											<b>价格：</b><span class="jg">￥{{objs.column5}}</span>
										</p>
										<p class="p col-md-6 col-xs-6">
											<b>标签：</b><span class="bq">{{objs.column2}}</span>
										</p>
									</div>
									<div class="but">
										<a href="http://www.baidu.com"><button class="col-xs-12"
												:value="objs.id">查看详情</button></a> <a><button
												class="col-xs-12" data-toggle="modal"
												data-target="#exampleModal">推荐给TA</button></a>
									</div>
								</div>
							</div>
						</div>
					</div>
					<!-- modal -->
					<div class="modal fade" id="exampleModal" tabindex="-1"
						role="dialog" aria-labelledby="exampleModalLabel">
						<div class="modal-dialog" role="document">
							<div class="modal-content">
								<div class="modal-header">
									<button type="button" class="close" data-dismiss="modal"
										aria-label="Close">
										<span aria-hidden="true">&times;</span>
									</button>
									<h4 class="modal-title" id="exampleModalLabel">邮件推送</h4>
								</div>
								<div class="modal-body">
									<form>
										<div class="form-group">
											<label for="recipient-name" class="control-label">邮件标题:</label>
											<input type="text" class="form-control" id="recipient-name">
										</div>
										<div class="form-group">
											<label for="message-text" class="control-label">邮件内容:</label>
											<textarea class="form-control" placeholder="不填则使用默认文案"
												id="message-text"></textarea>
										</div>
									</form>
								</div>
								<div class="list-group">
									<a href="#" class="list-group-item list-group-item-warning h6">如需使用到客户名称则在文案中加入'[cName]',例：尊敬的
										[cName] 您好...</a>
								</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-default"
										data-dismiss="modal">取消</button>
									<button type="button" class="btn btn-primary send">推送</button>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class='news'>消息通知</div>
	</div>
	<script>
		function news(text){
			$(".news").addClass("animated bounce delay-1s").text(text).show();
			setTimeout(function(){
				$(".news").addClass("animated fadeOutDown delay-1s");
			},2000);
			setTimeout(function(){
				$(".news").removeClass("animated fadeOutDown delay-1s");
				$(".news").removeClass("animated bounce delay-1s").hide();
			},2500);
		}
		var vue = new Vue({
			el : ".main",
			data : {
				goods : [],
				customer : []
			},
			methods : {
				imgUlr : function(url) {
					return "../assets/img" + url;
				}
			}
		});
		function sendMail(addRessee, title, content, img, cName, text,phone) {
			$.ajax({
				url : "/ther/SendMail",
				type : "post",
				traditional : true,
				data : {
					Addressee : addRessee,
					title : title,
					content : content,
					img : img,
					cName : cName,
					text : text,
					phone:phone
				},
				dataType : "json",
				success : function(resp) {
					if (resp == "0") {
						news("~~失败啦~~");
					} else {
						news("推送完成啦~~");
					}
				}

			});
		}
		var mail = "";
		var lid = "";
		var season = "";
		var cName = "";
		var title = "";
		var phone = "";
		var sid = getStoreId() != "" ? getStoreId() : undefined;

		$(function() {

			vue.goods = queryLikeGoodsValue(lid, season);
			vue.customer = queryCustomer(sid);
			$(".store").change(function() {
				var value = $(this).val().split(",");
				cName = value[2];
				mail = value[1];
				lid = value[0];
				phone = value[3];
				vue.goods = queryLikeGoodsValue(lid, season);
			});
			$(".season").change(function() {
				season = $(this).val();
				vue.goods = queryLikeGoodsValue(lid, season);
			});
			$(".send")
					.click(
							function() {
								title = $("#recipient-name").val();
								if(lid == ""){
									news("请先选择客户哦~");
									return false;
								}
								if(mail == "" || mail == undefined){
									news("该客户暂未有邮箱~");
									return false;
								}
								if(title == ""){
									news("请先填写邮件主题");
									return false;
								}
								var img = [];
								var content = [];
								$.each(
												$(".gv"),
												function(i, obj) {
													var goods = $(obj).html();
													var u = $(goods)
															.find("img").attr(
																	"src")
															.split("/goods/");
													img.push(u[1]);
													var div = "<div style='width: 45%;height: 380px;margin-left: 3%;float: left;margin-top:55px;box-shadow:0px 0px 15px #e2dbbe;'>"
															+ "<img style='width: 100%;height: 220px;' src='"
															+ $(goods)
																	.find("img")
																	.attr("src")
															+ "' />"
															+ "<div style='height: 180px;width: 100%;border: 1px solid #3287B2;border-top: 0px;'>"
															+ "<h3 style='color:#a3a380;float: left;margin: 20px 10px;white-space: nowrap;display: inline-block;width: 100%;height: 40px;overflow: hidden;text-overflow: ellipsis;'>"
															+ $(goods).find(
																	".name>b")
																	.text()
															+ "</h3>"
															+ "<span style='color:#a3a380;float: left;margin-left: 10%;margin-top: 8px;font-size: 18px;'>价格: <b style='color: #00C800;font-size:16px;'>"
															+ $(goods).find(
																	".jg")
																	.text()
															+ "</b></span>"
															+ "<span style='color:#a3a380;float: right;margin-right: 10%;margin-top: 8px;font-size: 18px;'>标签: <b style='color: #00C800;font-size:16px;'>"
															+ $(goods).find(
																	".bq")
																	.text()
															+ "</b></span>"
															+ "<a href='' style='width:100%;height:40px;line-height:40px;float:left;display: block;text-align: center;text-decoration: none;font-size: 20px;background-color: #4cb4e7;margin-top: 25px;color: #FFFFFF;'>查看详情</a>"
															+ "</div>"
															+ "</div>";
													content.push(div);
												});
								$("#exampleModal").modal('hide'); 
								sendMail(mail,title,content,img,cName,$("#message-text").val(),phone);
							});
		});
	</script>
</body>
</html>